<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Catheterization Form - HeartForms</title>
    <style>
        /* General Reset & Body */
        :root {
            --blue-600: #2563EB;
            --blue-700: #1D4ED8;
            --blue-50: #EFF6FF;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-900: #111827;
            --white: #FFFFFF;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            margin: 0;
            background-color: var(--gray-100);
            color: var(--gray-900);
        }

        /* Print styles */
        @page {
            size: letter;
            margin: 0.5in;
        }

        @media print {
            body { background-color: var(--white); }
            body * { visibility: hidden; }
            #printableArea, #printableArea * { visibility: visible; }
            #printableArea {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: auto;
                page-break-inside: avoid;
            }
            .no-print { display: none !important; }
        }

        /* Layout & Components */
        #app {
            max-width: 80rem;
            margin-left: auto;
            margin-right: auto;
            padding: 1rem;
        }

        .page-header {
            background-color: var(--white);
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-content h1 {
            font-size: 1.5rem;
            line-height: 2rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .header-content p {
            margin-top: 0.25rem;
            font-size: 0.875rem;
            line-height: 1.25rem;
            color: var(--gray-500);
        }
        
        .header-icon {
            height: 2.5rem;  
            width: 2.5rem;
            color: var(--blue-600);
        }

        .page-nav {
            margin-top: 1rem;
            border-top: 1px solid var(--gray-200);
            padding-top: 1rem;
            font-size: 0.875rem;
            color: var(--gray-600);
        }
        
        .page-nav a {
            color: var(--gray-600);
            text-decoration: none;
            margin: 0 0.75rem;
        }
        .page-nav a.home-link {
            color: var(--blue-600);
            font-weight: 500;
            margin-left: 0;
            margin-right: 0.75rem;
        }
        .page-nav a:hover {
            text-decoration: underline;
        }

        main .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        .card {
            background-color: var(--white);
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            border-radius: 0.5rem;
            padding: 1.5rem;
            border: 1px solid var(--gray-200);
            margin-bottom: 2rem;
        }
        .card:last-child {
            margin-bottom: 0;
        }

        .card-title {
            font-size: 1.125rem;
            line-height: 1.75rem;
            font-weight: 600;
            color: var(--gray-900);
            border-bottom: 1px solid var(--gray-200);
            padding-bottom: 0.75rem;
        }

        .form-grid {
            margin-top: 1rem;
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .form-grid label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
        }

        .form-input {
            margin-top: 0.25rem;
            display: block;
            width: 100%;
            border-radius: 0.375rem;
            border: 1px solid var(--gray-300);
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
        }
        .form-input:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            border-color: var(--blue-600);
            box-shadow: 0 0 0 2px var(--white), 0 0 0 4px rgba(59, 130, 246, 0.4);
        }

        .highlight-field {
            border-color: var(--blue-600);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4);
            background-color: var(--blue-50);
        }

        .button-group {
            margin-top: 0.5rem;
        }
        .button-group > button {
            margin-right: 0.5rem;
        }

        .btn {
            display: inline-block;
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            font-weight: 500;
            border-radius: 0.375rem;
            transition: background-color 200ms;
            border: 1px solid transparent;
            cursor: pointer;
        }
        .btn-primary {
            background-color: var(--blue-600);
            color: var(--white);
        }
        .btn-primary:hover {
            background-color: var(--blue-700);
        }
        .btn-secondary {
            background-color: var(--gray-200);
            color: var(--gray-700);
        }
        .btn-secondary:hover {
            background-color: var(--gray-300);
        }
        
        .action-buttons {
            margin-top: 2rem;
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem; /* Adds space between buttons */
        }

        .page-footer {
            text-align: center;
            margin-top: 3rem;
            color: var(--gray-500);
            font-size: 0.875rem;
        }

        /* Responsive Styles */
        @media (min-width: 640px) {
            #app { padding: 1.5rem; }
            .form-grid { grid-template-columns: repeat(2, 1fr); }
            .sm-col-span-2 { grid-column: span 2 / span 2; }
            .page-nav { font-size: 0.875rem; }
        }
        @media (min-width: 1024px) {
            #app { padding: 2rem; }
            .form-grid.meds-grid { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div id="app" class="container">
        
        <header class="page-header no-print">
            <div class="header-content">
                <div>
                    <h1>HeartForms</h1>
                    <p>Heart Catheterization Form</p>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" class="header-icon" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                </svg>
            </div>
            <nav class="page-nav">
                <a href="#" class="home-link">HeartForms Home</a> /
                <a href="#">Blank Heart Surgery Form</a> /
                <a href="#">Heart Cath Form</a> /
                <a href="#">KCCQ-12</a> /
                <a href="#">NYHA Classification</a> /
                <a href="#">Review of Systems</a>
            </nav>
        </header>

        <main class="no-print">
            <div class="grid">
                
                <div class="card">
                    <h2 class="card-title">Patient & Procedure Details</h2>
                    <div class="form-grid">
                        <div>
                            <label for="lname">Last Name</label>
                            <input type="text" id="lname" name="lname" class="form-input">
                        </div>
                        <div>
                            <label for="fname">First Name</label>
                            <input type="text" id="fname" name="fname" class="form-input">
                        </div>
                        <div class="sm-col-span-2">
                            <label for="clinic">Your Clinic/Hospital</label>
                            <input type="text" id="clinic" name="clinic" value="" class="form-input">
                        </div>
                        <div class="sm-col-span-2">
                            <label for="physician">Physician Performing Procedure</label>
                            <input type="text" id="physician" name="physician" class="form-input">
                        </div>
                         <div class="sm-col-span-2">
                            <label for="procedure">Procedure to be Performed</label>
                            <input type="text" id="procedure" name="procedure" class="form-input">
                            <div class="button-group">
                                <span style="font-size: 0.875rem; font-weight: 500; color: var(--gray-500); margin-right: 0.5rem;">Quick Add:</span>
                                <button type="button" onclick="Copytext1()" class="btn btn-secondary">Cath w/ PCI</button>
                                <button type="button" onclick="Copytext2()" class="btn btn-secondary">Right Heart Cath</button>
                                <button type="button" onclick="Copytext3()" class="btn btn-secondary">PCI</button>
                            </div>
                        </div>
                         <div class="sm-col-span-2">
                            <label for="location">Procedure Location</label>
                            <textarea id="location" name="location" rows="3" class="form-input"></textarea>
                        </div>
                        <div>
                            <label for="procdate">Date of Procedure</label>
                            <input type="date" id="procdate" name="procdate" class="form-input">
                        </div>
                         <div>
                            <label for="proctime">Arrival Time</label>
                            <input type="time" id="proctime" name="proctime" class="form-input">
                        </div>
                         <div class="sm-col-span-2">
                            <label for="phoneno">Facility's Phone Number</label>
                            <input type="tel" id="phoneno" name="phoneno" class="form-input">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 class="card-title">Medication Checklist</h2>
                    <form id="medform" class="form-grid meds-grid">
                        <div>
                            <label for="meds1">Coumadin/Warfarin</label>
                            <select id="meds1" name="meds1" class="form-input">
                                <option>No</option>
                                <option value="Coumadin/ Warfarin">Yes</option>
                            </select>
                        </div>
                         <div>
                            <label for="meds2">Eliquis/Xarelto/-xaban</label>
                            <select id="meds2" name="meds2" class="form-input">
                                <option>No</option>
                                <option value="Apixaban">Apixaban</option>
                                <option value="Betrixaban">Betrixaban</option>
                                <option value="Edoxaban">Edoxaban</option>
                                <option value="Eliquis">Eliquis</option>
                                <option value="Xarelto">Xarelto</option>
                            </select>
                        </div>
                         <div>
                            <label for="meds3">Insulin-Long Acting</label>
                            <select id="meds3" name="meds3" class="form-input">
                                <option>No</option>
                                <option value="Basaglar">Basaglar</option>
                                <option value="Glargine">Inuslin Glargine</option>
                                <option value="Insulin Degludec">Insulin Degludec</option>
                                <option value="Determir">Insulin Detemir</option>
                                <option value="Lantus">Lantus</option>
                                <option value="Levemir">Levemir</option>
                                <option value="Toujeo">Toujeo</option>
                                <option value="Tresiba">Tresiba</option>
                            </select>
                        </div>
                         <div>
                            <label for="meds4">Insulin-Short Acting</label>
                            <select id="meds4" name="meds4" class="form-input">
                                <option>No</option>
                                <option value="Novolin">Novolin</option>
                                <option value="Regular">Regular(R)</option>
                                <option value="Velosulin">Velosulin (For Insulin Pump)</option>
                            </select>
                        </div>
                         <div>
                            <label for="meds5">Metformin</label>
                            <select id="meds5" name="meds5" class="form-input">
                                <option>No</option>
                                <option value="metformin-pioglitazone (Actoplus Met, Actoplus Met XR)">metformin-pioglitazone (Actoplus Met, Actoplus Met XR)</option>
                                <option value="metformin-alogliptin (Kazano)">Metformin-alogliptin (Kazano)</option>
                                <option value="metformin-canagliflozin (Invokamet)">metformin-canagliflozin (Invokamet)</option>
                                <option value="metformin-dapagliflozin (Xigduo XR)">metformin-dapagliflozin (Xigduo XR)</option>
                                <option value="metformin-empagliflozin (Synjardy)">metformin-empagliflozin (Synjardy)</option>
                                <option value="metmorfin-ertugliflozin (Segluromet)">metmorfin-ertugliflozin (Segluromet)</option>
                                <option value="metformin-glipizide">metformin-glipizide</option>
                                <option value="metformin-glyburide (Glucovance)">metformin-glyburide (Glucovance)</option>
                                <option value="metformin-linagliptin (Jentadueto, Jentadueto XR)">metformin-linagliptin (Jentadueto, Jentadueto XR)</option>
                                <option value="Metformin">Metformin</option>
                                <option value="metformin-repaglinide (PrandiMet)">metformin-repaglinide (PrandiMet)</option>
                                <option value="metformin-rosiglitazone (Avandamet)">metformin-rosiglitazone (Avandamet)</option>
                                <option value="metformin-saxagliptin (Kombiglyze XR)">metformin-saxagliptin (Kombiglyze XR)</option>
                                <option value="metformin-sitagliptin (Janumet, Janumet XR)">metformin-sitagliptin (Janumet, Janumet XR)</option>
                                <option value="Glumetza">Glumetza</option>
                                <option value="Riomet">Riomet</option>
                            </select>
                        </div>
                         <div>
                            <label for="meds6">Sulfonylureas</label>
                            <select id="meds6" name="meds6" class="form-input">
                                <option>No</option>
                                <option value="gliclazide">gliclazide</option>
                                <option value="glimepiride (Amaryl)">glimepiride (Amaryl)</option>
                                <option value="glimepiride-pioglitazone (Duetact)">glimepiride-pioglitazone (Duetact)</option>
                                <option value="glipizide">glipizide</option>
                                <option value="glipizide ER (Glipizide XL, Glucotrol XL)">glipizide ER (Glipizide XL, Glucotrol XL)</option>
                                <option value="glipizide-metformin">glipizide-metformin</option>
                                <option value="glyburide (Glynase)">glyburide (Glynase)</option>
                                <option value="glyburide-metformin">glyburide-metformin</option>
                            </select>
                        </div>
                        <div>
                            <label for="meds7">ED Medications</label>
                            <select id="meds7" name="meds7" class="form-input">
                                <option>No</option>
                                <option value="Avanafil/ Stendra">Avanafil/ Stendra</option>
                                <option value="Cialis">Cialis</option>
                                <option value="Sildenafil">Sildenafil</option>
                                <option value="Tadalafil">Tadalafil</option>
                                <option value="Vardenafil">Vardenafil</option>
                                <option value="Viagra">Viagra</option>
                            </select>
                        </div>
                         <div>
                            <label for="meds8">GLP1 Agonist/-tide</label>
                            <select id="meds8" name="meds8" class="form-input">
                                <option>No</option>
                                <option value="dulaglutide">dulaglutide (Trulicity)</option>
                                <option value="exenatide">exenatide (Byetta, Bydureon)</option>
                                <option value="liraglutide">liraglutide (Victoza, Saxenda, Xultophy)</option>
                                <option value="lixisenatide">lixisenatide (Adlyxine, Soliqua)</option>
                                <option value="semaglutide">semaglutide (Ozempic, Wegovy, Rybelsus)</option>
                                <option value="tirzepatide">tirzepatide (Mounjaro)</option>
                            </select>
                        </div>
                         <div>
                            <label for="meds9">SGLT2 Inhibitors/-flozin</label>
                            <select id="meds9" name="meds9" class="form-input">
                                <option>No</option>
                                <option value="canagliflozin">canagliflozin (Invokana)</option>
                                <option value="dapagliflozin">dapagliflozin (Farxiga)</option>
                                <option value="empagliflozin">empagliflozin (Jardiance)</option>
                                <option value="ertugliflozin">ertugliflozin (Steglatro)</option>
                                <option value="sotagliflozin">sotagliflozin (Inpefa)</option>
                            </select>
                        </div>
                    </form>
                </div>
            </div>

            <div class="action-buttons">
                 <button type="button" onclick="generateReport()" class="btn btn-primary">Generate Report</button>
                 <button type="button" onclick="printReport()" id="printButton" class="btn btn-secondary" style="display: none;">Print</button>
            </div>
        </main>
        
        <div id="printableArea" style="display: none;">
             <style>
                 /* These styles are applied only to the printed content */
                 #printableArea { font-family: Arial, sans-serif; color: #333; font-size: 10pt; }
                 #printableArea h1 { text-align: center; font-size: 18pt; margin: 0 0 10px 0; border-bottom: 2px solid #ccc; padding-bottom: 5px;}
                 #printableArea h2 { font-size: 14pt; border-bottom: 1px solid #eee; padding-bottom: 3px; margin: 15px 0 5px 0; page-break-after: avoid; }
                 #printableArea h3 { font-size: 12pt; margin: 10px 0 5px 0; page-break-after: avoid; }
                 #printableArea p, #printableArea ul { line-height: 1.3; margin: 0 0 8px 0; }
                 #printableArea ul { padding-left: 20px; }
                 #printableArea b { font-weight: bold; }
                 #printableArea table { width: 100%; border-collapse: collapse; margin-top: 10px; page-break-inside: avoid;}
                 #printableArea th, #printableArea td { padding: 4px; text-align: left; border-bottom: 1px solid #ddd; }
                 #printableArea hr { margin: 10px 0; border: 0; border-top: 1px solid #ccc; }
             </style>
            <h1 id="Sch_Clinic"></h1>
            <p id="demo"></p>
            <p id="paraproc"></p>
            <hr>
            <h2>Medication Instructions</h2>
            <p id="medrec"></p>
            <hr>
            <h2>Day of Procedure</h2>
            <ul>
                <li>Do NOT eat or drink anything after midnight before procedure.</li>
                <li>DO take any of your regular medications the morning of procedure unless advised otherwise.</li>
                <li>Your family will be shown to the waiting room and will receive periodic updates.</li>
                <li>The physician will talk with you or your family after the procedure.</li>
            </ul>
            <h3 id="hospital_info"></h3>
            <hr>
            <table>
                <tr><th colspan="2"><h2>Call the office if... <span id="officenumber"></span></h2></th></tr>
                <tr><td>- any questions regarding procedure</td><td>- you develop an infection that requires antibiotics of any kind</td></tr>
                <tr><td>- there is any change in your condition</td><td>- you develop a fever, cold, or flu symptoms</td></tr>
                <tr><td>- are prescribed new medications</td><td></td></tr>
            </table>
        </div>

        <footer class="page-footer no-print">
            <p>&copy; 2025 HeartForms. All Rights Reserved.</p>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Highlight required fields on load ---
            const fieldsToHighlight = document.querySelectorAll(
                'input[type="text"], input[type="date"], input[type="time"], input[type="tel"], textarea'
            );

            fieldsToHighlight.forEach(field => {
                field.classList.add('highlight-field');
                field.addEventListener('focus', () => {
                    field.classList.remove('highlight-field');
                }, { once: true }); // Listener removes itself after first focus
            });
            
            // --- Alphabetize Medication Dropdowns ---
            alphabetizeDropdowns();
        });

        function alphabetizeDropdowns() {
            const selects = document.querySelectorAll('#medform select');
            selects.forEach(select => {
                // Get all options except the first one ("No")
                const options = Array.from(select.options).slice(1);
                
                options.sort((a, b) => a.text.localeCompare(b.text));

                // Remove old options
                while (select.options.length > 1) {
                    select.remove(1);
                }

                // Add sorted options back
                options.forEach(option => select.add(option));
            });
        }

        // --- TEXT COPYING FUNCTIONS ---
        function Copytext1() { document.getElementById("procedure").value = "Cardiac Catherization with possible intervention (Angioplasty/ Stent)"; }
        function Copytext2() { document.getElementById("procedure").value = "Right Heart Catherization"; }
        function Copytext3() { document.getElementById("procedure").value = "Percutaneous Coronary Intervention (PCI)"; }
        
        // --- FORM DATA GATHERING AND PROCESSING ---
        function fillOutForm() {
            // Patient and Procedure Info
            document.getElementById("Sch_Clinic").innerHTML = document.getElementById("clinic").value;
            const patlname = document.getElementById("lname").value;
            const patfname = document.getElementById("fname").value;
            document.getElementById("demo").innerHTML = `<b>Patient:</b> ${patfname} ${patlname}<br><b>Scheduled for:</b>`;
            
            const patproc = document.getElementById("procedure").value;
            const procloca = document.getElementById("location").value.replace(/\n/g, '<br>'); // Keep line breaks in HTML
            const dateprocInput = document.getElementById("procdate").value;
            
            let currentDate = 'Not specified';
            if (dateprocInput) {
                const dateproc = new Date(dateprocInput + 'T00:00:00'); // Use T00:00:00 to avoid timezone issues
                currentDate = `${dateproc.getMonth() + 1}/${dateproc.getDate()}/${dateproc.getFullYear()}`;
            }

            const timeproc = document.getElementById("proctime").value;
            document.getElementById("paraproc").innerHTML = `<b>${patproc}</b><br><br><b>Arrive at:</b><br>${procloca}<br><br><b>On:</b> ${currentDate} at <b>${timeproc}</b>`;
        }

        function generateMedicationRecommendations() {
            const medForm = document.getElementById("medform");
            let recommendations = []; // Use an array to store recommendations
            const medtext3 = "Take your last dose of ";

            // Get procedure date for calculations
            const procedureDateValue = document.getElementById("procdate").value;
            if (!procedureDateValue) {
                 document.getElementById("medrec").innerHTML = "Please select a procedure date to calculate medication instructions.";
                 return;
            }

            for (let j = 0; j < medForm.elements.length; j++) {
                const element = medForm.elements[j];
                if (element.tagName === 'SELECT' && element.value !== "No") {
                    let stopDate = new Date(procedureDateValue + 'T00:00:00');
                    let stopDays = 0;
                    let customInstruction = null;

                    switch (j) {
                        case 0: stopDays = 5; break; // Coumadin
                        case 1: stopDays = 2; break; // Eliquis/Xarelto
                        case 2: // Insulin-Long Acting
                            const longActingDate = new Date(procedureDateValue + 'T00:00:00');
                            longActingDate.setDate(longActingDate.getDate() - 1); // Day before
                            customInstruction = `Take a <b>half dose</b> of your ${element.value} on the evening of ${longActingDate.toLocaleDateString()}.`;
                            break;
                        case 3: // Insulin-Short Acting
                            const shortActingDate = new Date(procedureDateValue + 'T00:00:00');
                            customInstruction = `Do NOT take your morning dose of ${element.value} on the day of your procedure, ${shortActingDate.toLocaleDateString()}.`;
                            break;
                        case 4: // Metformin - restart 3 days after
                            const restartDate = new Date(procedureDateValue + 'T00:00:00');
                            restartDate.setDate(restartDate.getDate() + 3);
                            customInstruction = `Do NOT take ${element.value} on the day of your procedure. You may resume it on ${restartDate.toLocaleDateString()}.`;
                            break;
                        case 5: stopDays = 1; break; // Sulfonylureas
                        case 6: stopDays = 2; break; // ED Meds
                        case 7: stopDays = 6; break; // GLP1
                        case 8: stopDays = 2; break; // SGLT2
                    }

                    if (customInstruction) {
                        recommendations.push(customInstruction);
                    } else if (stopDays > 0) {
                        stopDate.setDate(stopDate.getDate() - stopDays);
                        recommendations.push(`${medtext3}<b>${element.value}</b> on <b>${stopDate.toLocaleDateString()}</b>.`);
                    }
                }
            }

            // Alphabetize the recommendations
            recommendations.sort();

            let recommendationsText = recommendations.join("<br>");
            if (recommendationsText === "") {
                recommendationsText = "No specific medication holds identified. Patient should continue their prescribed medications unless told otherwise.";
            }
            
            const phonenum = document.getElementById("phoneno").value;
            document.getElementById("officenumber").innerText = `(${phonenum})`;
            document.getElementById("medrec").innerHTML = recommendationsText + `<br><br>If you have any questions, call the office at <b>${phonenum}</b>.`;
        }
        
        // This function hides the printable area again after the print dialog is closed.
        window.addEventListener('afterprint', () => {
            document.getElementById('printableArea').style.display = 'none';
        });

        function generateReport() {
            // Fill the data into the printable div
            fillOutForm();
            generateMedicationRecommendations();

            // Make the printable area ready (but not visible on screen) and show the print button
            document.getElementById('printableArea').style.display = 'block';
            document.getElementById('printButton').style.display = 'inline-block';
        }

        function printReport() {
            // Trigger the print dialog
            window.print();
        }

    </script>
</body>
</html>
