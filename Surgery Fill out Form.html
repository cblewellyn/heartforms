<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blank Surgery Form - HeartForms</title>
    <style>
        :root {
            --blue-600: #2563EB;
            --blue-700: #1D4ED8;
            --blue-50: #EFF6FF;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-900: #111827;
            --white: #FFFFFF;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            margin: 0;
            background-color: var(--gray-100);
            color: var(--gray-900);
        }

        @media print {
            body * { visibility: hidden; }
            #printableArea, #printableArea * { visibility: visible; }
            #printableArea { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                padding: 1rem;
                box-sizing: border-box;
            }
            .no-print { display: none !important; }
        }

        #app {
            max-width: 80rem;
            margin: auto;
            padding: 1rem;
        }

        .page-header {
            background-color: var(--white);
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-content h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .header-content p {
            margin-top: 0.25rem;
            font-size: 0.875rem;
            color: var(--gray-500);
        }
        
        .header-icon {
             height: 2.5rem; 
             width: 2.5rem;
             color: var(--blue-600);
             fill: currentColor;
        }

        .page-nav {
            margin-top: 1rem;
            border-top: 1px solid var(--gray-200);
            padding-top: 1rem;
            font-size: 0.875rem;
        }
        
        .page-nav a {
            color: var(--gray-600);
            text-decoration: none;
            margin: 0 0.75rem;
        }
        .page-nav a.home-link {
            color: var(--blue-600);
            font-weight: 500;
            margin-left: 0;
        }
        .page-nav a:hover {
            text-decoration: underline;
        }

        .card {
            background-color: var(--white);
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            border-radius: 0.5rem;
            padding: 1.5rem;
            border: 1px solid var(--gray-200);
            margin-bottom: 2rem;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            border-bottom: 1px solid var(--gray-200);
            padding-bottom: 0.75rem;
            margin-bottom: 1rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .form-grid label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
        }

        .form-input {
            margin-top: 0.25rem;
            display: block;
            width: 100%;
            border-radius: 0.375rem;
            border: 1px solid var(--gray-300);
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
        }
        .form-input:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            border-color: var(--blue-600);
            box-shadow: 0 0 0 2px var(--white), 0 0 0 4px rgba(59, 130, 246, 0.4);
        }
        
        .btn {
            display: inline-block;
            padding: 0.6rem 1.2rem;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 0.375rem;
            transition: background-color 200ms;
            border: 1px solid transparent;
            cursor: pointer;
        }
        .btn-primary {
            background-color: var(--blue-600);
            color: var(--white);
        }
        .btn-primary:hover {
            background-color: var(--blue-700);
        }
        .btn-secondary {
            background-color: var(--gray-200);
            color: var(--gray-700);
        }
        .btn-secondary:hover {
            background-color: var(--gray-300);
        }
        
        .action-buttons {
            margin-top: 2rem;
            display: flex;
            gap: 0.5rem;
        }

        .page-footer {
            text-align: center;
            margin-top: 3rem;
            color: var(--gray-500);
            font-size: 0.875rem;
        }
        
        #printableArea {
            margin-top: 2rem;
            padding: 1.5rem;
            border: 2px dashed var(--blue-600);
            border-radius: 0.5rem;
            background-color: var(--blue-50);
        }

        @media (min-width: 640px) {
            .form-grid { grid-template-columns: repeat(2, 1fr); }
            .sm-col-span-2 { grid-column: span 2 / span 2; }
        }
         @media (min-width: 1024px) {
            .meds-grid { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
    <div id="app">
        <header class="page-header no-print">
            <div class="header-content">
                <div>
                    <h1>HeartForms</h1>
                    <p>Blank Heart Surgery Form</p>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" class="header-icon" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                </svg>
            </div>
            <nav class="page-nav">
                <a href="https://cblewellyn.github.io/heartforms/" class="home-link">HeartForms Home</a> /
                <a href="https://cblewellyn.github.io/heartforms/Surgery%20Fill%20out%20Form.html">Blank Heart Surgery Form</a> /
                <a href="https://cblewellyn.github.io/heartforms/Heart_Cath_form.html">Heart Cath Form</a> /
                <a href="https://cblewellyn.github.io/heartforms/KCCQ12.html">KCCQ-12</a> /
                <a href="https://cblewellyn.github.io/heartforms/NYHA_HF_Scale.html">NYHA Classification</a> /
                <a href="https://cblewellyn.github.io/heartforms/ROS_doc.html">Review of Systems</a> /
		<a href="https://cblewellyn.github.io/heartforms/CathCalc.html">Cath Lab Calculations</a>
            </nav>
        </header>

        <main>
            <form id="surgery-form">
                <div class="card no-print">
                    <h2 class="card-title">Patient & Surgery Details</h2>
                    <div class="form-grid">
                        <div><label for="fname">First Name:</label><input type="text" id="fname" class="form-input"></div>
                        <div><label for="lname">Last Name:</label><input type="text" id="lname" class="form-input"></div>
                        <div class="sm-col-span-2"><label for="PracticeName">Name of Practice:</label><input type="text" id="PracticeName" class="form-input"></div>
                        <div class="sm-col-span-2"><label for="surgery">The Surgery is:</label><input type="text" id="surgery" class="form-input"></div>
                        <div><label for="surgerydate">Surgery Date:</label><input type="date" id="surgerydate" class="form-input"></div>
                        <div><label for="appt">Arrive at hospital at:</label><input type="time" id="appt" class="form-input"></div>
                        <div class="sm-col-span-2"><label for="SurgeonName">Your Surgeon will be:</label><input type="text" id="SurgeonName" class="form-input"></div>
                        <div class="sm-col-span-2"><label for="surg_location">Hospital/Clinic for Surgery:</label><input type="text" id="surg_location" class="form-input"></div>
                        <div><label for="surg_phone">Surgery Site Phone:</label><input type="tel" id="surg_phone" class="form-input"></div>
                        <div><label for="Officephone">Your Office/Clinic Phone:</label><input type="tel" id="Officephone" class="form-input"></div>
                    </div>
                </div>

                <div class="card no-print">
                    <h2 class="card-title">Medication Checklist</h2>
                    <div id="medform" class="form-grid meds-grid">
                        <div><label for="meds0">Aspirin</label><select id="meds0" class="form-input"><option>No</option><option value="Aspirin">Yes</option></select></div>
                        <div><label for="meds1">ACE/ '-pril's:</label><select id="meds1" class="form-input"><option>No</option><option value="Benazepril">Benazepril</option><option value="Captopril">Captopril</option><option value="Enalapril">Enalapril</option><option value="Fosinopril">Fosinopril</option><option value="Lisinopril">Lisinopril</option><option value="Ramipril">Ramipril</option></select></div>
                        <div><label for="meds2">ARB/ '-sartans':</label><select id="meds2" class="form-input"><option>No</option><option value="Azilsartan">Azilsartan/ Edarbi</option><option value="Candsartan">Candesartan/ Atacand</option><option value="Irbesartan">Irbesartan/ Avapro</option><option value="Losartan">Losartan/ Cozaar</option><option value="Olmesartan">Olmesartan/ Benicar</option><option value="Telmisartan">Telmisartan/ Micardis</option><option value="Valsartan">Valsartan/ Diovan</option></select></div>
                        <div><label for="meds3">Brilinta/ Ticagrelor:</label><select id="meds3" class="form-input"><option>No</option><option value="Brilinta/ Ticagrelor">Yes</option></select></div>
                        <div><label for="meds4">Clopidogrel/ Plavix:</label><select id="meds4" class="form-input"><option>No</option><option value="Clopidogrel/ Plavix">Yes</option></select></div>
                        <div><label for="meds5">Coumadin/ Warfarin:</label><select id="meds5" class="form-input"><option>No</option><option value="Coumadin/ Warfarin">Yes</option></select></div>
                        <div><label for="meds6">Effient/ Prasugrel:</label><select id="meds6" class="form-input"><option>No</option><option value="Effient/ Prasugrel">Yes</option></select></div>
                        <div><label for="meds7">Eliquis/ Xarelto/ '-xaban':</label><select id="meds7" class="form-input"><option>No</option><option value="Apixaban">Apixaban</option><option value="Betrixaban">Betrixaban</option><option value="Edoxaban">Edoxaban</option><option value="Eliquis">Eliquis</option><option value="Xarelto">Xarelto</option></select></div>
                        <div><label for="meds8">Metformin:</label><select id="meds8" class="form-input"><option>No</option><option value="Metformin">Yes</option></select></div>
                        <div><label for="meds9">Phenprocoumon:</label><select id="meds9" class="form-input"><option>No</option><option value="Phenprocoumon">Yes</option></select></div>
                        <div><label for="meds10">Pradaxa/ Dabigatran:</label><select id="meds10" class="form-input"><option>No</option><option value="Pradaxa/ Dabigatran">Yes</option></select></div>
                        <div><label for="meds11">ED Medications:</label><select id="meds11" class="form-input"><option>No</option><option value="Avanafil/ Stendra">Avanafil/ Stendra</option><option value="Cialis">Cialis</option><option value="Sildenafil">Sildenafil</option><option value="Tadalafil">Tadalafil</option><option value="Vardenafil">Vardenafil</option><option value="Viagra">Viagra</option></select></div>
                        <div><label for="meds12">Insulin-Long Acting</label><select id="meds12" class="form-input"><option>No</option><option value="Glargine">Inuslin Glargine</option><option value="Basaglar">Basaglar</option><option value="Lantus">Lantus</option><option value="Toujeo">Toujeo</option><option value="Determir">Insulin Detemir</option><option value="Levemir">Levemir</option><option value="Insulin Degludec">Insulin Degludec</option><option value="Tresiba">Tresiba</option></select></div>
                        <div><label for="meds13">Insulin-Short Acting</label><select id="meds13" class="form-input"><option>No</option><option value="Regular">Regular(R)</option><option value="Novolin">Novolin</option><option value="Velosulin">Velosulin (For Insulin Pump)</option></select></div>
                        <div><label for="meds14">Sulfonylureas:</label><select id="meds14" class="form-input"><option>No</option><option value="glimepiride (Amaryl)">glimepiride (Amaryl)</option><option value="glimepiride-pioglitazone (Duetact)">glimepiride-pioglitazone (Duetact)</option><option value="gliclazide">gliclazide</option><option value="glipizide">glipizide</option><option value="glipizide ER (Glipizide XL, Glucotrol XL)">glipizide ER (Glipizide XL, Glucotrol XL)</option><option value="glipizide-metformin">glipizide-metformin</option><option value="glyburide (Glynase)">glyburide (Glynase)</option><option value="glyburide-metformin">glyburide-metformin</option></select></div>
                        <div><label for="meds15">GLP1 Agonist/-tide</label><select id="meds15" class="form-input"><option>No</option><option value="dulaglutide">dulaglutide (Trulicity)</option><option value="exenatide">exenatide (Byetta, Bydureon)</option><option value="liraglutide">liraglutide (Victoza, Saxenda, Xultophy)</option><option value="lixisenatide">lixisenatide (Adlyxine, Soliqua)</option><option value="semaglutide">semaglutide (Ozempic, Wegovy, Rybelsus)</option><option value="tirzepatide">tirzepatide (Mounjaro)</option></select></div>
                        <div><label for="meds16">SGLT2 Inhibitors/-flozin</label><select id="meds16" class="form-input"><option>No</option><option value="canagliflozin">canagliflozin (Invokana)</option><option value="dapagliflozin">dapagliflozin (Farxiga)</option><option value="empagliflozin">empagliflozin (Jardiance)</option><option value="ertugliflozin">ertugliflozin (Steglatro)</option><option value="sotagliflozin">sotagliflozin (Inpefa)</option></select></div>
                    </div>
                </div>

                <div class="action-buttons no-print">
                    <button type="button" onclick="generateReport()" class="btn btn-primary">Generate Report</button>
                    <button type="button" onclick="window.print()" class="btn btn-secondary">Print Report</button>
                    <button type="reset" class="btn btn-secondary">Reset Form</button>
                </div>
            </form>
        </main>
        
        <div id="printableArea">
            <!-- Content will be generated here by JavaScript -->
        </div>

    </div>

    <script>
        function generateReport() {
            let practiceName = document.getElementById("PracticeName").value;
            let firstName = document.getElementById("fname").value;
            let lastName = document.getElementById("lname").value;
            let surgery = document.getElementById("surgery").value;
            let surgeryDateStr = document.getElementById("surgerydate").value;
            let arrivalTime = document.getElementById("appt").value;
            let surgeonName = document.getElementById("SurgeonName").value;
            let surgeryLocation = document.getElementById("surg_location").value;
            let surgeryPhone = document.getElementById("surg_phone").value;
            let officePhone = document.getElementById("Officephone").value;
            
            if (!surgeryDateStr) {
                alert("Please enter a surgery date.");
                return;
            }
            
            let surgeryDate = new Date(surgeryDateStr + 'T00:00:00');
            let formattedSurgeryDate = surgeryDate.toLocaleDateString();

            let patientInfoHTML = `
                <h1>${practiceName}</h1>
                <p><b>Patient:</b> ${firstName} ${lastName}</p>
                <p><b>Is scheduled for the surgery:</b> ${surgery}</p>
                <p><b>Arrive at ${surgeryLocation} on:</b> ${formattedSurgeryDate} at ${arrivalTime}</p>
                <p><b>Your surgeon will be:</b> ${surgeonName}</p>
            `;

            let medInstructionsHTML = "<h2>Medication Instructions</h2><p>Some of your medications will need to be stopped prior to surgery. Prior to surgery:</p><ul>";
            
            const medContainer = document.getElementById("medform");
            const medSelects = medContainer.querySelectorAll('select');
            let instructionsArray = [];
            
            for (let i = 0; i < medSelects.length; i++) {
                const medSelect = medSelects[i];
                if (medSelect.value !== "No") {
                    let stopDate = new Date(surgeryDate.getTime());
                    let customInstruction = null;
                    let stopDays = 0;
                    let instructionString = '';

                    // Map med IDs to stop days or custom logic
                    switch(medSelect.id) {
                        case 'meds0': stopDays = 1; break;  // Aspirin
                        case 'meds1': stopDays = 3; break;  // ACE
                        case 'meds2': stopDays = 3; break;  // ARB
                        case 'meds3': stopDays = 6; break;  // Brilinta
                        case 'meds4': stopDays = 6; break;  // Plavix
                        case 'meds5': stopDays = 6; break;  // Coumadin
                        case 'meds6': stopDays = 8; break;  // Effient
                        case 'meds7': stopDays = 3; break;  // DOACs
                        case 'meds8': // Metformin
                            const restartDate = new Date(surgeryDate.getTime());
                            restartDate.setDate(restartDate.getDate() + 4);
                            customInstruction = `Do NOT take ${medSelect.value} on the day of your surgery. You may resume it on <b>${restartDate.toLocaleDateString()}</b>.`;
                            break;
                        case 'meds9': stopDays = 6; break;  // Phenprocoumon
                        case 'meds10': stopDays = 6; break; // Pradaxa
                        case 'meds11': stopDays = 3; break; // ED Meds
                        case 'meds12': // Insulin-Long
                            const longActingDate = new Date(surgeryDate.getTime());
                            longActingDate.setDate(longActingDate.getDate() - 2);
                            customInstruction = `Take a <b>half dose</b> of your ${medSelect.value} on the evening of <b>${longActingDate.toLocaleDateString()}</b>.`;
                            break;
                        case 'meds13': // Insulin-Short
                            const shortActingDate = new Date(surgeryDate.getTime());
                            shortActingDate.setDate(shortActingDate.getDate() - 1);
                            customInstruction = `Do NOT take your morning dose of ${medSelect.value} on the day of your surgery, <b>${formattedSurgeryDate}</b>. Your last dose should be on <b>${shortActingDate.toLocaleDateString()}</b>.`;
                            break;
                        case 'meds14': stopDays = 2; break; // Sulfonylureas
                        case 'meds15': stopDays = 7; break; // GLP1
                        case 'meds16': stopDays = 3; break; // SGLT2
                    }

                    if (customInstruction) {
                        instructionString = customInstruction;
                    } else if (stopDays > 0) {
                        stopDate.setDate(stopDate.getDate() - stopDays);
                        instructionString = `Take your last dose of <b>${medSelect.value}</b> on <b>${stopDate.toLocaleDateString()}</b>.`;
                    }
                    
                    if(instructionString) {
                       instructionsArray.push({name: medSelect.value, instruction: instructionString});
                    }
                }
            }
            
            if (instructionsArray.length > 0) {
                instructionsArray.sort((a, b) => a.name.localeCompare(b.name));
                instructionsArray.forEach(item => {
                    medInstructionsHTML += `<li>${item.instruction}</li>`;
                });
            } else {
                medInstructionsHTML += "<li>No specific medication holds identified. Please follow your surgeon's instructions.</li>";
            }
            medInstructionsHTML += "</ul>";

            let finalInstructionsHTML = `
                <h2>Day of Surgery</h2>
                <ul>
                    <li>Do NOT eat or drink anything after midnight before surgery.</li>
                    <li>Do NOT take any of your regular medications the morning of surgery unless instructed to do so by anesthesia at your pre-admission appointment.</li>
                    <li>Your family will be shown to the surgery waiting room and will receive periodic updates.</li>
                    <li>The surgeon will talk with you or your family after surgery.</li>
                    <li>If you have questions regarding visitation during hospitalization please call: <b>${surgeryPhone}</b></li>
                </ul>
                <h2>Call the office at ${officePhone} if...</h2>
                <ul>
                    <li>any questions regarding surgery</li>
                    <li>you develop an infection that requires antibiotics of any kind</li>
                    <li>there is any change in your condition</li>
                    <li>you develop a fever, cold, or flu symptoms</li>
                    <li>you are prescribed new medications</li>
                </ul>
            `;

            const printableArea = document.getElementById('printableArea');
            printableArea.innerHTML = `
                <style>
                    body { font-family: Arial, sans-serif; font-size: 10pt; line-height: 1.4; }
                    h1 { font-size: 16pt; text-align: center; margin: 0 0 10px 0; padding-bottom: 5px; border-bottom: 1px solid #ccc; }
                    h2 { font-size: 12pt; margin-top: 15px; border-bottom: 1px solid #eee; padding-bottom: 3px; }
                    p { margin: 5px 0; }
                    ul { list-style-type: '— '; padding-left: 20px; margin-top: 5px; }
                    li { margin-bottom: 4px; }
                </style>
                ${patientInfoHTML}
                ${medInstructionsHTML}
                ${finalInstructionsHTML}
            `;
            printableArea.style.display = 'block';
        }

        function generateAndPrint() {
            generateReport();
            setTimeout(() => window.print(), 100); // Timeout to ensure content is rendered
        }
    </script>
</body>
</html>
